<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Pastel Gallery</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --bg:#f6f8ff;
  --card:#ffffff;
  --text:#334155;
  --muted:#94a3b8;
  --line:#e5e7eb;
  --blue:#93c5fd;
  --pink:#fbcfe8;
  --radius:18px;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system;
  background:
    radial-gradient(800px 400px at 10% 10%, #fde7f3, transparent),
    radial-gradient(700px 400px at 90% 20%, #e0f2fe, transparent),
    var(--bg);
  color:var(--text);
}
.container{max-width:1100px;margin:24px auto;padding:0 16px}
h1{margin:0}
.card{
  background:var(--card);
  border-radius:var(--radius);
  padding:16px;
  margin:16px 0;
  box-shadow:0 10px 25px rgba(0,0,0,.06);
}
.row{display:flex;gap:10px;flex-wrap:wrap}
input,select{
  padding:12px;border-radius:14px;border:1px solid var(--line);
}
button{
  padding:12px 16px;border-radius:14px;border:none;
  background:linear-gradient(135deg,var(--blue),var(--pink));
  font-weight:700;cursor:pointer;
}
button.secondary{background:#f1f5f9}

.foldersGrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:14px}
.folderCard{border:1px solid var(--line);border-radius:16px;overflow:hidden}
.folderThumb{height:140px;background:#f1f5f9;display:flex;align-items:center;justify-content:center}
.folderThumb img{width:100%;height:100%;object-fit:cover}
.folderMeta{padding:12px;font-weight:700;display:flex;justify-content:space-between}

.dropzone{
  border:2px dashed #c7d2fe;
  border-radius:18px;
  padding:24px;
  text-align:center;
  background:#fdf2f8;
}
.dropzone.drag{background:#e0f2fe}

.gallery{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:14px}
.thumb{border:1px solid var(--line);border-radius:16px;overflow:hidden}
.thumb img{width:100%;height:160px;object-fit:cover}
.meta{padding:12px}
</style>
</head>

<body>
<div class="container">

<h1>ðŸŒ¸ Pastel Gallery</h1>

<!-- Folder View -->
<div class="card">
  <h2>Folders</h2>
  <div id="foldersGrid" class="foldersGrid"></div>
</div>

<!-- Upload -->
<div class="card">
  <div class="row">
    <select id="uploadFolder"></select>
    <input id="uploadTags" placeholder="tags (optional)">
    <button class="secondary" id="btnChoose">Choose images</button>
    <input type="file" id="fileInput" accept="image/*" multiple hidden>
  </div>
  <div id="dropzone" class="dropzone">Drag & Drop images here</div>
</div>

<!-- Gallery -->
<div class="card">
  <h2>Gallery</h2>
  <div id="gallery" class="gallery"></div>
</div>

</div>

<script>
const KEY="pastel_gallery_fixed";
const $=id=>document.getElementById(id);

/* ---------- STATE ---------- */
let state = JSON.parse(localStorage.getItem(KEY));
if(!state || !state.folders){
  state={folders:{Default:[]}};
  save();
}

function save(){
  localStorage.setItem(KEY,JSON.stringify(state));
}

function uid(){
  return Date.now()+"_"+Math.random().toString(16).slice(2);
}

function ensureFolder(name){
  if(!state.folders[name]){
    state.folders[name]=[];
  }
}

/* ---------- UI ---------- */
function refreshFolders(){
  const sel=$("uploadFolder");
  sel.innerHTML="";
  Object.keys(state.folders).forEach(f=>{
    const o=document.createElement("option");
    o.value=f;o.textContent=f;
    sel.appendChild(o);
  });
  if(!sel.value) sel.value="Default";
  renderFolders();
}

function renderFolders(){
  const g=$("foldersGrid");
  g.innerHTML="";
  Object.entries(state.folders).forEach(([f,imgs])=>{
    const cover=imgs.slice().sort((a,b)=>b.t-a.t)[0];
    g.innerHTML+=`
      <div class="folderCard">
        <div class="folderThumb">
          ${cover?`<img src="${cover.src}">`:"No image"}
        </div>
        <div class="folderMeta">${f}<span>${imgs.length}</span></div>
      </div>`;
  });
}

/* ---------- FILE HANDLING ---------- */
function readFile(file){
  return new Promise((resolve,reject)=>{
    const r=new FileReader();
    r.onload=()=>resolve(r.result);
    r.onerror=reject;
    r.readAsDataURL(file);
  });
}

async function uploadFiles(fileList){
  const folder=$("uploadFolder").value || "Default";
  ensureFolder(folder);

  const tags=$("uploadTags").value
    .split(",").map(t=>t.trim()).filter(Boolean);

  for(const file of fileList){
    if(!file.type.startsWith("image/")) continue;
    const src=await readFile(file);
    state.folders[folder].push({
      id:uid(),
      name:file.name,
      src,
      tags,
      t:Date.now()
    });
  }
  save();
  renderFolders();
  renderGallery();
}

/* ---------- EVENTS ---------- */
$("btnChoose").addEventListener("click",()=>{
  $("fileInput").value="";
  $("fileInput").click();
});

$("fileInput").addEventListener("change",e=>{
  if(e.target.files.length){
    uploadFiles(e.target.files);
  }
});

const dz=$("dropzone");
dz.addEventListener("dragover",e=>{
  e.preventDefault();dz.classList.add("drag");
});
dz.addEventListener("dragleave",()=>dz.classList.remove("drag"));
dz.addEventListener("drop",e=>{
  e.preventDefault();dz.classList.remove("drag");
  if(e.dataTransfer.files.length){
    uploadFiles(e.dataTransfer.files);
  }
});

/* ---------- GALLERY ---------- */
function renderGallery(){
  const g=$("gallery");
  g.innerHTML="";
  Object.values(state.folders).flat().forEach(i=>{
    g.innerHTML+=`
      <div class="thumb">
        <img src="${i.src}">
        <div class="meta">${i.name}</div>
      </div>`;
  });
}

/* ---------- INIT ---------- */
refreshFolders();
renderGallery();
</script>
</body>
</html>
